## 消息管理

1) 获取消息列表  
GET /v1/chat/conversations/{conversation_id}/messages
- 响应: {"conversation_id":"...","messages":[Message,...]} 或 404

2) 追加消息并获取回复（需鉴权）  
POST /v1/chat/conversations/{conversation_id}/messages
- 请求体: { role:"user"|"assistant"|..., content:string, model:string="ChatGPT-4o-Latest", stream:bool=false, documents?: [int,...] }
  - documents 可选。为 plan_documents 表中的 id 数组。若提供，将按 id 查询 filename 与 content，并按如下格式拼装为“知识库”，在提交远端 LLM 前追加到当前会话的 system prompt 之后，仅用于本次请求上下文：
    ----- {filename1} BEGINE -----
    {content 1}
    ----- {filename1} END -----

    ----- {filename2} BEGINE -----
    {content 2}
    ----- {filename2} END -----
- 非流式响应:
  - {"conversation_id":"...","reply":"...","user_message_id":int|null,"assistant_message_id":int}
- SSE 流式:
  - 首帧: {"user_message_id":int|null,"assistant_message_id":int,"conversation_id":"...","session_id":"..."}
  - 多帧: {"content":"partial text"}
  - 完成: {"content":"","finish_reason":"stop"} + [DONE]
- 忽略用户策略:
  - 若 role=user 且 content 完全匹配 Config.ignoredUserMessages，则不会入库该 user 消息，但仍可带入上下文

3) 批量删除消息  
POST /v1/chat/messages/delete
- 请求体: {"message_ids":[int,...]}
- 响应: {"message":"{n} messages deleted"}

4) 停止流式会话  
POST /v1/chat/stop-stream
- 请求体: {"session_id":"..."}
- 响应: {"message":"Stream stopped","session_id":"..."}